/**
 * avatar extension for Contao Open Source CMS
 *
 * @copyright  Copyright (c) 2008-2014, terminal42 gmbh
 * @author     terminal42 gmbh <info@terminal42.ch>
 * @license    http://opensource.org/licenses/lgpl-3.0.html LGPL
 * @link       http://github.com/terminal42/contao-avatar
 */
;jQuery.noConflict();(function(e){"use strict";var t={backend:false};var n;var r;var i;var s="";var o=false;var u=function(){i=new qq.FineUploader({element:n.find(".upload_container")[0],debug:false,multiple:false,request:{endpoint:window.location.href,inputName:t.field+"_upload",params:{action:"avatar_upload",name:t.field,REQUEST_TOKEN:t.request_token}},failedUploadTextDisplay:{mode:"custom",maxChars:1e3,responseProperty:"error"},validation:{allowedExtensions:t.extensions,sizeLimit:t.sizeLimit},text:{formatProgress:t.labels.text.formatProgress,failUpload:t.labels.text.failUpload,waitingForResponse:t.labels.text.waitingForResponse,paused:t.labels.text.paused},messages:{tooManyFilesError:t.labels.messages.tooManyFilesError,unsupportedBrowser:t.labels.messages.unsupportedBrowser},retry:{autoRetryNote:t.labels.retry.autoRetryNote},deleteFile:{confirmMessage:t.labels.deleteFile.confirmMessage,deletingStatusText:t.labels.deleteFile.deletingStatusText,deletingFailedText:t.labels.deleteFile.deletingFailedText},paste:{namePromptMessage:t.labels.paste.namePromptMessage},callbacks:{onUpload:function(){if(o){AjaxRequest.displayBox(Contao.lang.loading+" …")}},onComplete:function(r,i,u){if(!u.success){if(o){AjaxRequest.hideBox()}return}s=u.file;e.ajax({url:window.location.href,data:{action:"avatar_reload",name:t.field,value:s,REQUEST_TOKEN:t.request_token},type:"POST",complete:function(e){if(o){AjaxRequest.hideBox();window.fireEvent("ajax_change")}},success:function(e){n.find(".ajax_container").html(e);a();f()}})}}})};var a=function(){var r;n.find(".thumbnail").Jcrop({allowResize:false,allowSelect:false,setSelect:[0,0,t.avatarSize[0],t.avatarSize[1]]},function(){r=this});n.find(".crop_link").on("click",function(i){i.preventDefault();var u=r.tellSelect();e.ajax({url:window.location.href,data:{action:"avatar_reload",name:t.field,value:s,crop:u.x+","+u.y,REQUEST_TOKEN:t.request_token},type:"POST",beforeSend:function(){if(o){AjaxRequest.displayBox(Contao.lang.loading+" …")}},complete:function(e){if(o){AjaxRequest.hideBox();window.fireEvent("ajax_change")}},success:function(e){n.find(".ajax_container").html(e);f()}})})};var f=function(){n.find(".delete_link").on("click",function(e){e.preventDefault();l()})};var l=function(){r.val("");n.find(".work_container").html("")};e.fn.Avatar=function(i){e.extend(t,i);n=e(this);u();r=e("#ctrl_"+t.field);if(t.backend){o=true}s=r.val();if(s!=""){f()}return this}})(jQuery);